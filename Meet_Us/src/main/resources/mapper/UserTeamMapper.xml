<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Meet_Us.userTeam.dao.UserTeamMapper">

   <!--아이디 중복 체크 -->
   <select id="userIdCheck" parameterType="String" resultType="int">
   SELECT 
            COUNT(*) 
   FROM 
            MEET_USER 
   WHERE 
            USER_ID = #{user_id}
   </select>
   
   <select id="emailIsCheck" parameterType="String" resultType="int">
   SELECT 
            COUNT(*) 
   FROM 
            MEET_USER 
   WHERE 
            USER_EMAIL = #{user_email}
   </select>
   
   <select id="seqlIsCheck" parameterType="int" resultType="int">
   SELECT 
            COUNT(*) 
   FROM 
            MEET_USER 
   WHERE 
            USER_SEQ=  #{user_seq}
   </select>
   
   <insert id="userInsert" parameterType="Meet_Us.userTeam.vo.UserTeamVo">
   INSERT INTO 
   MEET_USER(   
            USER_SEQ,
            USER_ID,
            USER_PASSWORD,
            USER_EMAIL,
            USER_NAME,
            USER_AGE,
            USER_GENDER,
            USER_DEFAULTADDRESS,
            USER_AUTHORITY,
            USER_KAKAOIMG) 
   VALUES(
            #{user_seq},
            #{user_id},
            #{user_password},
            #{user_email},
            #{user_name},
            DATE_FORMAT(now(), '%Y') - #{user_age} +1,
            #{user_gender},
            #{user_defaultAddress},
            #{user_authority},
            #{user_kakaoImg}
            )
   </insert>
   
   <select id="userIdMin" resultType="int">
   SELECT 
            COUNT(USER_EMAIL) USER_SEQ 
   FROM 
            MEET_USER
   </select>
   
   <!--    이메일 인증 확인 로직 -->
   <select id="emailConfirm" parameterType="Meet_Us.userTeam.vo.UserTeamVo" resultType="int">
   SELECT 
            count(USER_SEQ) 
   FROM 
            MEET_USER
   WHERE 
            USER_AUTHORITY=#{user_authority}
   AND       
            USER_EMAIL=#{user_email}
   </select>
   
   <!--    이메일 인증이 성공하면 수정하는 로직 -->
   <update id="updateEmailConfirm" parameterType="String">
   UPDATE 
            MEET_USER 
   SET 
            USER_AUTHORITY="Y" 
   WHERE       
            USER_EMAIL=#{user_email}
   </update>
   
   <!--    회원 아이디 찾기 -->
   <select id="SeachUserId" parameterType="Meet_Us.userTeam.vo.UserTeamVo" resultType="String">   
   SELECT 
            USER_ID
   FROM 
            MEET_USER
   WHERE 
            USER_NAME=#{user_name}
   AND 
            USER_EMAIL=#{user_email}
   AND         
            USER_AUTHORITY='Y'
   </select>
   
   <!--    회원 비밀번호 찾기 -->
   <select id="SeachUserPw" parameterType="Meet_Us.userTeam.vo.UserTeamVo" resultType="int">
   SELECT 
            COUNT(USER_SEQ)
   FROM        
            MEET_USER
   where
            USER_ID=#{user_id}
   AND
            USER_EMAIL=#{user_email}
   AND         
            USER_NAME=#{user_name}
   AND         
            USER_AUTHORITY='Y'
   </select>
   
   
   <!--    비밀번호 업데이트 -->
   <update id="UpdateUserPw" parameterType="Meet_Us.userTeam.vo.UserTeamVo">
   UPDATE 
            MEET_USER 
   SET       
            USER_PASSWORD= #{user_password}
   WHERE 
            USER_EMAIL= #{user_email}
   AND 
            USER_ID= #{user_id}
   AND 
            USER_NAME= #{user_name}
   </update>

   <select id="userLogin" parameterType="Meet_Us.userTeam.vo.UserTeamVo" resultType="int">
   SELECT 
            count(*)
   FROM 
            MEET_USER
   WHERE 
            USER_ID=#{user_id}
   AND 
            USER_PASSWORD=#{user_password}
   AND 
            USER_AUTHORITY='Y'
   </select>

</mapper>